import{a as Ve,b as Be}from"./chunk-OUIBNN2C.js";import"./chunk-FK6H3RFT.js";import{a as Re,b as Ge}from"./chunk-S6EI7WZV.js";import{a as Se,b as ve,c as we,d as be,e as Me,f as Pe,g as ye,h as De,i as Ee,j as Ie,k as Ne,l as R,m as G,n as Te,p as z}from"./chunk-N6UEQAJC.js";import"./chunk-2X63TOLZ.js";import{a as L}from"./chunk-O4K67Y33.js";import"./chunk-WABPTNBF.js";import{d as Fe}from"./chunk-SKXK7KA7.js";import{c as A,d as Oe,e as ke,g as $,h as j,i as q}from"./chunk-FX4T5NY5.js";import{b as v,c as O,d as me,g as w,h as se,j as M}from"./chunk-655M5PPB.js";import{E as H,l as P}from"./chunk-P2K7FNZD.js";import{k as he}from"./chunk-LTQGHVNP.js";import"./chunk-4VZRQQ4V.js";import"./chunk-VRPWBVGA.js";import{b as k,d as b,g as F,h as pe,i as ue,k as V,m as ge,o as Ce,p as fe,q as _e,u as xe,x as B}from"./chunk-QVV4KUCD.js";import"./chunk-2PPFUFFT.js";import{Ab as m,Ba as Z,Cb as ee,Gb as f,Hb as te,Jb as ne,Kb as ae,Lb as i,Mb as o,Nb as g,Ob as D,Pb as E,Rb as I,Tc as ce,Ub as s,Wb as c,Ya as d,ca as C,cc as Y,dc as ie,eb as U,ec as oe,fc as r,gb as y,gc as N,hc as T,ka as _,kb as S,la as x,nc as re,qb as u,rc as le,sc as de}from"./chunk-42JAANS2.js";import{a as $e}from"./chunk-AJIQVFNV.js";import{e as Ae}from"./chunk-C6Q5SG76.js";function qe(n,t){if(n&1&&g(0,"app-sale-button",3),n&2){let e=t.$implicit;m("viewOnly",!0)("gameCard",e)}}var Q=class n{dialogRef=C(A);data=C(Oe);cards=y(this.data);userForm=new V("",[b.required,b.minLength(3),b.maxLength(30)]);onNoClick(){this.dialogRef.close()}onSubmit(){this.userForm.valid&&this.userForm.value&&(this.cards.set(this.cards().map(t=>({sold:!0,userName:this.userForm.value,cardId:t.cardId,gameId:t.gameId,contentMatrix:t.contentMatrix,cardNumber:t.cardNumber,serialId:t.serialId}))),this.dialogRef.close(this.cards()))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-sale-card-dialog"]],inputs:{cards:[1,"cards"]},outputs:{cards:"cardsChange"},decls:17,vars:2,consts:[["mat-dialog-title",""],[1,"dialog-content-div"],[1,"selected-cards-div"],[3,"viewOnly","gameCard"],["appearance","outline"],["matInput","","maxlength","30",3,"formControl"],["mat-button","",3,"click"]],template:function(e,a){e&1&&(i(0,"h2",0),r(1,"Cartas a vender:"),o(),i(2,"mat-dialog-content",1)(3,"div",2),ne(4,qe,1,2,"app-sale-button",3,te),o(),i(6,"mat-form-field",4)(7,"mat-label"),r(8,"Nombre del comprador"),o(),g(9,"input",5),i(10,"mat-hint"),r(11),o()()(),i(12,"mat-dialog-actions")(13,"button",6),s("click",function(){return a.onNoClick()}),r(14,"Cancelar venta"),o(),i(15,"button",6),s("click",function(){return a.onSubmit()}),r(16,"Finalizar venta"),o()()),e&2&&(d(4),ae(a.cards()),d(5),m("formControl",a.userForm),d(2),N(a.userForm.hasError("minlength")?"reuiere minimo 3 caracteres":a.userForm.hasError("required")?"campo requerido":""))},dependencies:[$,j,q,P,Ge,w,v,M,B,k,F,xe,Ce,O],styles:[".dialog-content-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.selected-cards-div[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;max-width:400px;gap:.5rem;max-height:400px;overflow-y:scroll}"]})};var J=Ae($e());function Qe(n,t){if(n&1&&(i(0,"div",7)(1,"p"),r(2),o()()),n&2){let e=c();d(2),N(e.errorMessage)}}function We(n,t){if(n&1&&(i(0,"div",8)(1,"h3"),r(2,"Vista previa"),o(),i(3,"div",13),g(4,"app-personal-bingo-card",14),o()()),n&2){let e=c();d(4),m("card",e.previewCard)}}var W=class n{dialogRef=C(A);gameService=C(H);searchForm=new ue({cardIdControl:new V("",[b.required])});previewCard=null;errorMessage=null;onSearch(){this.errorMessage=null;let t=this.searchForm.value.cardIdControl;if(!t||isNaN(Number(t))){this.errorMessage="Por favor, ingrese un ID num\xE9rico v\xE1lido.";return}let e=Number(this.searchForm.value.cardIdControl)||0,a=this.gameService.gameCards().find(l=>l.cardNumber===e);a?this.previewCard={cardNumber:e,content:a.contentMatrix.map(l=>({number:l,marked:!1}))}:(this.errorMessage=`No se encontr\xF3 ninguna carta con el ID ${e}.`,this.previewCard=null)}exportToPDF(){let t=document.querySelector(".card-preview-element");if(t&&this.previewCard){let e=this.previewCard.cardNumber,a=4;(0,J.default)(t,{scale:a,width:t.scrollWidth,height:t.scrollHeight}).then(l=>{let p=l.toDataURL("image/png"),h=l.width/a,K=l.height/a,X=new Be({orientation:"portrait",unit:"px",format:[h,K]});X.addImage(p,"PNG",0,0,h,K),X.save(`carta_${e}.pdf`)})}}exportToPNG(){let t=document.querySelector(".card-preview-element");if(t&&this.previewCard){let e=this.previewCard.cardNumber;(0,J.default)(t,{scale:4,width:t.scrollWidth,height:t.scrollHeight}).then(l=>{let p=l.toDataURL("image/png"),h=document.createElement("a");h.href=p,h.download=`carta_${e}.png`,h.click()})}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-export-card-dialog"]],decls:20,vars:5,consts:[["mat-dialog-title",""],[1,"export-content"],[3,"formGroup"],[1,"search-section"],["appearance","outline"],["matInput","","formControlName","cardIdControl"],["mat-flat-button","","color","primary",3,"click"],[1,"error-message"],[1,"preview-section"],[1,"dialog-actions"],[1,"export-buttons"],["text","Exportar PDF","color","primary",3,"click","disabled"],["text","Exportar PNG","color","accent",3,"click","disabled"],[1,"card-preview-element"],[3,"card"]],template:function(e,a){e&1&&(i(0,"h2",0),r(1,"Exportar Carta"),o(),i(2,"mat-dialog-content")(3,"div",1)(4,"form",2)(5,"div",3)(6,"mat-form-field",4)(7,"mat-label"),r(8,"ID de la carta"),o(),g(9,"input",5),i(10,"mat-hint"),r(11,"Ingrese el ID de la carta a exportar"),o()(),i(12,"button",6),s("click",function(){return a.onSearch()}),r(13,"Buscar"),o()()(),u(14,Qe,3,1,"div",7)(15,We,5,1,"div",8),o()(),i(16,"mat-dialog-actions",9)(17,"div",10)(18,"app-rectanglebutton",11),s("click",function(){return a.exportToPDF()}),o(),i(19,"app-rectanglebutton",12),s("click",function(){return a.exportToPNG()}),o()()()),e&2&&(d(4),m("formGroup",a.searchForm),d(10),f(a.errorMessage?14:-1),d(),f(a.previewCard?15:-1),d(3),m("disabled",!a.previewCard),d(),m("disabled",!a.previewCard))},dependencies:[Ve,$,v,M,q,j,w,O,se,B,ge,k,F,pe,fe,_e,L,P],styles:["h3[_ngcontent-%COMP%]{margin-top:20px}.error-message[_ngcontent-%COMP%]{color:red;font-weight:700;margin-top:10px}.export-content[_ngcontent-%COMP%]{padding:1rem;display:flex;flex-direction:column;gap:1rem;align-items:center}.export-content[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;align-items:center}.export-content[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%;max-width:400px}.export-content[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{align-self:center;padding:10px 20px;background-color:#7b2cbf;color:#fff;font-size:16px;font-weight:700;border-radius:8px;box-shadow:0 4px 6px #0003;transition:all .3s ease}.export-content[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#1565c0;box-shadow:0 6px 8px #0000004d}.export-content[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{transform:scale(.98)}.dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:16px}.dialog-actions[_ngcontent-%COMP%]   .export-buttons[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}"]})};var Ue=()=>[5,10];function Ye(n,t){n&1&&(i(0,"h2"),r(1,"Adjunta primero un serial a la partida para poder gestionar su venta"),o())}function Je(n,t){if(n&1){let e=I();i(0,"div",3),g(1,"app-bingo-card",21),i(2,"button",22),s("click",function(){_(e);let l=c(2);return x(l.openExportDialog())}),r(3," Buscar y Exportar Carta "),o()()}if(n&2){let e=c(2);d(),m("card",e.displayedCard)("boughtBy",e.displayedCardBuyer)}}function Ke(n,t){n&1&&(i(0,"th",23),r(1," N\xFAmero de carton "),o())}function Xe(n,t){if(n&1&&(i(0,"td",24),r(1),o()),n&2){let e=t.$implicit;d(),T("N\xBA ",e.cardNumber,"")}}function Ze(n,t){n&1&&(i(0,"th",23),r(1," Estado de la carta "),o())}function et(n,t){n&1&&r(0," VENDIDO ")}function tt(n,t){n&1&&r(0," NO VENDIDO ")}function nt(n,t){if(n&1&&(i(0,"td",24),u(1,et,1,0)(2,tt,1,0),o()),n&2){let e=t.$implicit;d(),f(e.sold?1:2)}}function at(n,t){n&1&&(i(0,"th",23),r(1," Nombre del comprador "),o())}function it(n,t){if(n&1&&(r(0),le(1,"titlecase")),n&2){let e=c().$implicit;T(" ",de(1,1,e.userName)," ")}}function ot(n,t){n&1&&r(0," - - - - - - - - - - - - - - ")}function rt(n,t){if(n&1&&(i(0,"td",24),u(1,it,2,3)(2,ot,1,0),o()),n&2){let e=t.$implicit;d(),f(e.userName.length>0?1:2)}}function lt(n,t){n&1&&g(0,"tr",25)}function dt(n,t){if(n&1&&(i(0,"tr",26)(1,"td",27),r(2),o()()),n&2){c();let e=oe(10);d(2),T('no se encontro un carton con el nombre "',e.value,'"')}}function ct(n,t){if(n&1){let e=I();i(0,"tr",28),s("click",function(){let l=_(e).$implicit,p=c(2);return x(p.selectCard(l))})("mouseover",function(){let l=_(e).$implicit,p=c(2);return x(p.displayCard(l))})("tap",function(){let l=_(e).$implicit,p=c(2);return x(p.displayCard(l))}),o()}if(n&2){let e=t.$implicit,a=c(2);ee("selected-row",a.selectedCards().includes(e))("sold-row",e.sold&&!a.selectedCards().includes(e))("unsold-row",!e.sold&&!a.selectedCards().includes(e))}}function mt(n,t){if(n&1){let e=I();i(0,"div",1)(1,"div",2),u(2,Je,4,2,"div",3),i(3,"app-rectanglebutton",4),s("click",function(){_(e);let l=c();return x(l.sellCards())}),o()(),i(4,"div")(5,"div",5)(6,"mat-form-field",6)(7,"mat-label"),r(8,"Buscar por nombre..."),o(),i(9,"input",7,0),s("keyup",function(l){_(e);let p=c();return x(p.applyFilter(l))}),o(),i(11,"mat-icon",8),r(12,"search"),o()(),i(13,"table",9),D(14,10),u(15,Ke,2,0,"th",11)(16,Xe,2,1,"td",12),E(),D(17,13),u(18,Ze,2,0,"th",11)(19,nt,3,1,"td",12),E(),D(20,14),u(21,at,2,0,"th",11)(22,rt,3,1,"td",12),E(),u(23,lt,1,0,"tr",15)(24,dt,3,1,"tr",16)(25,ct,1,6,"tr",17),o(),g(26,"mat-paginator",18),o()()(),i(27,"div",19)(28,"button",20),r(29,"Siguiente"),o()()}if(n&2){let e=c();d(2),f(e.displayedCard?2:-1),d(11),m("dataSource",e.dataSource),d(10),m("matHeaderRowDef",e.columns),d(2),m("matRowDefColumns",e.columns),d(),m("showFirstLastButtons",!0)("pageSizeOptions",re(6,Ue))}}var He=class n{dataSource=new R;sort=U.required(G);paginator=U.required(z);pageSize=y(25);pageIndex=y(0);pageSizeOptions=[15,25,40];columns=["cardNumber","sold","userName"];gameService=C(H);displayedCard;displayedCardBuyer;selectedCards=Z([]);dialog=C(ke);displayCard(t){this.displayedCard={cardNumber:t.cardNumber,content:t.contentMatrix.map(e=>({number:e,marked:!1,lastNumber:0}))},t.userName.length>2?this.displayedCardBuyer=t.userName:this.displayedCardBuyer=void 0}ngAfterViewInit(){setTimeout(()=>{this.dataSource=new R(this.gameService.gameCards()),this.dataSource.sort=this.sort(),this.dataSource.paginator=this.paginator(),this.dataSource.filterPredicate=(t,e)=>t.userName.trim().toLowerCase().includes(e.trim())||t.cardNumber.toString().includes(e)},1e3)}ngOnInit(){this.gameService.getCardsByGameId()}selectCard(t){this.selectedCards().includes(t)?this.selectedCards.update(e=>e.filter(a=>a!==t)):this.selectedCards.update(e=>[...e,t])}updateLocalPagination(t){this.pageSize.set(t.pageSize),this.pageIndex.set(t.pageIndex)}getPaginatedList(){return this.gameService.gameCards().slice(this.pageIndex()*this.pageSize(),this.pageIndex()*this.pageSize()+this.pageSize())}sellCards(){this.selectedCards().length>0&&this.dialog.open(Q,{data:this.selectedCards(),hasBackdrop:!0}).afterClosed().subscribe(e=>{e&&(e.forEach(a=>{this.gameService.sellCard(a)}),this.selectedCards.set([]),this.pageSize.set(25),setTimeout(()=>{this.dataSource=new R(this.gameService.gameCards()),this.dataSource.sort=this.sort(),this.dataSource.paginator=this.paginator()},1e3))})}openExportDialog(){this.dialog.open(W,{width:"500px"})}applyFilter(t){let e=t.target.value;this.dataSource.filter=e.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-sale-panel"]],viewQuery:function(e,a){e&1&&(Y(a.sort,G,5),Y(a.paginator,z,5)),e&2&&ie(2)},inputs:{pageSize:[1,"pageSize"],pageIndex:[1,"pageIndex"]},outputs:{pageSize:"pageSizeChange",pageIndex:"pageIndexChange"},decls:2,vars:1,consts:[["input",""],[1,"sale-panel-div"],[1,"sale-actions-panel-div"],[1,"card-preview-sale"],["text","Vender cartones seleccionados",3,"click"],[1,"sale-cards-panel-div"],["appearance","outline",1,"serial-searcher"],["matInput","","placeholder","Buscar por nombre...",3,"keyup"],["matSuffix",""],["mat-table","","matSort","",1,"example-table",3,"dataSource"],["matColumnDef","cardNumber"],["class","serial-table-header","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","sold"],["matColumnDef","userName"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matNoDataRow"],["mat-row","",3,"selected-row","sold-row","unsold-row","click","mouseover","tap",4,"matRowDef","matRowDefColumns"],["pageSize","10","aria-label","Elige pagina de seriales",3,"showFirstLastButtons","pageSizeOptions"],[1,"next-step-div"],["mat-raised-button","","matStepperNext",""],[1,"card",3,"card","boughtBy"],[1,"export-button",3,"click"],["mat-header-cell","","mat-sort-header","",1,"serial-table-header"],["mat-cell",""],["mat-header-row",""],["mat-row",""],["colspan","4"],["mat-row","",3,"click","mouseover","tap"]],template:function(e,a){e&1&&u(0,Ye,2,0,"h2")(1,mt,30,7),e&2&&f(a.gameService.gameCards().length<1?0:1)},dependencies:[Te,Re,z,L,P,Fe,v,me,he,M,w,G,we,Me,be,Se,Pe,ve,Ee,Ie,De,Ne,ye,ce],styles:[".sale-actions-panel-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem}.next-step-div[_ngcontent-%COMP%]{display:flex;flex-direction:row;place-content:end}.selected-row[_ngcontent-%COMP%]{background-color:#6495ed}.sold-row[_ngcontent-%COMP%]{background-color:#90ee90}.unsold-row[_ngcontent-%COMP%]{background-color:#cd5c5c}.card-preview-sale[_ngcontent-%COMP%]{width:320px;display:flex;flex-direction:column;align-items:center;justify-content:center}button[_ngcontent-%COMP%]{border:none;outline:none;cursor:pointer;font-size:1rem;font-weight:700;border-radius:8px;padding:.8rem 1.5rem;transition:all .3s ease-in-out;box-shadow:0 4px 6px #0000001a;display:flex;align-items:center;justify-content:center}.export-button[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;margin:.5rem 0;width:100%;text-align:center}.export-button[_ngcontent-%COMP%]:hover{background-color:#45a049;transform:translateY(-2px)}.export-button[_ngcontent-%COMP%]:active{background-color:#3e8e41;transform:translateY(0)}.sale-cards-panel-div[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem;align-items:center;justify-content:center}.sale-panel-div[_ngcontent-%COMP%]{padding:1rem 0;display:grid;grid-template-columns:2fr 3fr;grid-gap:1rem;align-items:center}@media (max-width: 900px){.sale-panel-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}}@media (max-width: 600px){button[_ngcontent-%COMP%]{font-size:.9rem;padding:.6rem 1.2rem}app-rectanglebutton[_ngcontent-%COMP%]{font-size:1rem;padding:.7rem 1.8rem}}"]})};export{He as SalePanelComponent};
